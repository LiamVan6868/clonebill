<?php require $_SERVER['DOCUMENT_ROOT'].'/config/database.php';require($_SERVER['DOCUMENT_ROOT'].'/models/object/users/generatorSubdomain.php');ini_set('display_errors',1);ini_set('display_startup_errors',1);error_reporting(E_ALL);function deleteSubdomain($subdomain){global $set_email,$set_auth_key;$set_zone_id='';$CFAPI=new \Cloudflare\Api($set_email,$set_auth_key);$CFDNS=new \Cloudflare\Zone\Dns($CFAPI);$records=$CFDNS->list_records($set_zone_id,null,$subdomain);$records=json_decode(json_encode($records),true);echo"Received records for subdomain {$subdomain}: ";print_r($records);if(isset($records['success'])&&$records['success']&&!empty($records['result'])){foreach($records['result']as $record){$delete=$CFDNS->delete_record($set_zone_id,$record['id']);$delete=json_decode(json_encode($delete),true);echo"Delete result for record ID {$record['id']}: ";print_r($delete);if(!isset($delete['success'])||!$delete['success']){echo "Error deleting subdomain record: ".(isset($delete['errors'])?$delete['errors'][0]['message']:'An unknown error occurred.')."\n";return false;}}echo"Subdomain {$subdomain} and its records with IP 123.45.67.89 deleted from Cloudflare.\n";}else{echo"No records with IP 123.45.67.89 found for subdomain {$subdomain}. No deletion performed.\n";}}function deleteAllSubdomains(){$stmt=DatabaseConnection::ThanhDieuDB()->prepare("SELECT ten_mien, hauto FROM ws_subdomain");$stmt->execute();$result=$stmt->get_result();while($row=$result->fetch_assoc()){$subdomain=$row['ten_mien'].'.'.$row['hauto'];$set_zone_id=ZoneId($subdomain);if(!$set_zone_id){exit("Lỗi tên miền phụ này không hợp lệ.");}deleteSubdomain($subdomain);}}deleteAllSubdomains();